{"version":3,"sources":["propertyFields/collectionData/collectionDataViewer/CollectionDataViewer.tsx"],"names":[],"mappings":"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","file":"propertyFields/collectionData/collectionDataViewer/CollectionDataViewer.js","sourcesContent":["import * as React from 'react';\nimport styles from '../PropertyFieldCollectionDataHost.module.scss';\nimport { ICollectionDataViewerProps, ICollectionDataViewerState } from '.';\nimport { CollectionDataItem } from '../collectionDataItem';\nimport { PrimaryButton, DefaultButton } from 'office-ui-fabric-react/lib/components/Button';\nimport { Icon } from 'office-ui-fabric-react/lib/components/Icon';\nimport * as strings from 'PropertyControlStrings';\nimport { cloneDeep, sortBy } from '@microsoft/sp-lodash-subset';\n\nexport class CollectionDataViewer extends React.Component<ICollectionDataViewerProps, ICollectionDataViewerState> {\n  private readonly SORT_IDX = \"sortIdx\";\n\n  constructor(props: ICollectionDataViewerProps) {\n    super(props);\n\n    this.state = {\n      crntItems: [],\n      inCreationItem: null,\n      validation: {}\n    };\n  }\n\n  /**\n   * componentDidMount lifecycle hook\n   */\n  public componentDidMount(): void {\n    let crntItems = this.props.value ? sortBy(cloneDeep(this.props.value), this.SORT_IDX) : [];\n    crntItems = crntItems.map((item, idx) => {\n      if (!item[this.SORT_IDX]) {\n        item[this.SORT_IDX] = idx + 1;\n      }\n      return item;\n    });\n    // Update the sort propety\n    crntItems = this.updateSortProperty(crntItems);\n    this.setState({\n      crntItems: sortBy(crntItems, this.SORT_IDX)\n    });\n  }\n\n  /**\n   * Add a new item to the collection\n   */\n  private addItem = (item: any) => {\n    this.setState((prevState: ICollectionDataViewerState): ICollectionDataViewerState => {\n      let crntItems = [...prevState.crntItems, item];\n      crntItems = this.updateSortProperty(crntItems);\n      return {\n        crntItems,\n        inCreationItem: null\n      };\n    });\n  }\n\n  /**\n   * Remove an item from the collection\n   */\n  private updateItem = (idx: number, item: any) => {\n    this.setState((prevState: ICollectionDataViewerState): ICollectionDataViewerState => {\n      const { crntItems } = prevState;\n      // Update the item in the array\n      crntItems[idx] = item;\n      return { crntItems };\n    });\n  }\n\n  /**\n   * Remove an item from the collection\n   */\n  private deleteItem = (idx: number) => {\n    this.setState((prevState: ICollectionDataViewerState): ICollectionDataViewerState => {\n      let { crntItems } = prevState;\n      crntItems.splice(idx, 1);\n\n      // Update the sort propety\n      crntItems = this.updateSortProperty(crntItems);\n\n      return {\n        crntItems: sortBy(crntItems, this.SORT_IDX)\n      };\n    });\n  }\n\n  /**\n   * Validate every item\n   */\n  private validateItem = (idx: number, isValid: boolean) => {\n    this.setState((prevState: ICollectionDataViewerState) => {\n      const { validation } = prevState;\n      validation[idx] = isValid;\n      return {\n        validation: prevState.validation\n      };\n    });\n  }\n\n  /**\n   * Check if all items are valid\n   */\n  private allItemsValid() {\n    const { validation } = this.state;\n    if (validation) {\n      const keys = Object.keys(validation);\n      for (const key of keys) {\n        if (!validation[key]) {\n          return false;\n        }\n      }\n    }\n    return true;\n  }\n\n  /**\n   * Currently in creation\n   */\n  private addInCreation = (item: any) => {\n    this.setState({\n      inCreationItem: item\n    });\n  }\n\n  /**\n   * Add the item and save the form\n   */\n  private addAndSave = () => {\n    // Check if the item is not empty\n    if (this.state.inCreationItem) {\n      this.props.fOnSave([...this.state.crntItems, this.state.inCreationItem]);\n    } else {\n      this.onSave();\n    }\n  }\n\n  /**\n   * Move an item in the array\n   *\n   * @param crntItems\n   * @param oldIdx\n   * @param newIdx\n   */\n  private moveItemTo(crntItems: any[], oldIdx: number, newIdx: number): any[] {\n    if (newIdx > -1 && newIdx < crntItems.length) {\n      const removedElement = crntItems.splice(oldIdx, 1)[0];\n      if (removedElement) {\n        crntItems.splice(newIdx, 0, removedElement);\n      }\n    }\n    return crntItems;\n  }\n\n  /**\n   * Update the sort property\n   *\n   * @param crntItems\n   */\n  private updateSortProperty(crntItems: any[]): any[] {\n    // Update the sort order\n    return crntItems.map((item, itemIdx) => {\n      item[this.SORT_IDX] = itemIdx + 1;\n      return item;\n    });\n  }\n\n  /**\n   * Update the sort order\n   */\n  private updateSortOrder = (oldIdx: number, newIdx: number) => {\n    this.setState((prevState: ICollectionDataViewerState) => {\n      const { crntItems } = prevState;\n      let newOrderedItems = cloneDeep(crntItems);\n      newOrderedItems = this.moveItemTo(newOrderedItems, oldIdx, newIdx - 1);\n      newOrderedItems = this.updateSortProperty(newOrderedItems);\n      newOrderedItems = sortBy(newOrderedItems, this.SORT_IDX);\n\n      return {\n        crntItems: newOrderedItems\n      };\n    });\n  }\n\n  /**\n   * Save the collection data\n   */\n  private onSave = () => {\n    this.props.fOnSave(this.state.crntItems);\n  }\n\n  /**\n   * Cancel\n   */\n  private onCancel = () => {\n    this.props.fOnClose();\n  }\n\n  /**\n   * Default React render\n   */\n  public render(): React.ReactElement<ICollectionDataViewerProps> {\n    return (\n      <div>\n        <div className={styles.table}>\n          <div className={`${styles.tableRow} ${styles.tableHead}`}>\n            {\n              this.props.enableSorting && (\n                <span className={styles.tableCell}></span>\n              )\n            }\n            {\n              this.props.fields.map(f => (\n                <span key={`dataviewer-${f.id}`} className={styles.tableCell}>{f.title} { f.required && <Icon className={styles.required} iconName=\"Asterisk\" /> }</span>\n              ))\n            }\n            <span className={styles.tableCell}></span>\n            <span className={styles.tableCell}></span>\n          </div>\n          {\n            (this.state.crntItems && this.state.crntItems.length > 0) && (\n              this.state.crntItems.map((item, idx, allItems) => (\n                <CollectionDataItem key={item.uniqueId}\n                                    fields={this.props.fields}\n                                    index={idx}\n                                    item={item}\n                                    totalItems={allItems.length}\n                                    sortingEnabled={this.props.enableSorting}\n                                    disableItemDeletion={this.props.disableItemDeletion}\n                                    fUpdateItem={this.updateItem}\n                                    fDeleteItem={this.deleteItem}\n                                    fValidation={this.validateItem}\n                                    fOnSorting={this.updateSortOrder} />\n              ))\n            )\n          }\n\n          {\n            !this.props.disableItemCreation && (\n              <CollectionDataItem fields={this.props.fields}\n                                  index={null}\n                                  item={null}\n                                  sortingEnabled={this.props.enableSorting}\n                                  totalItems={null}\n                                  fAddItem={this.addItem}\n                                  fAddInCreation={this.addInCreation} />\n            )\n          }\n        </div>\n\n        {\n          (!this.state.crntItems || this.state.crntItems.length === 0) && (\n            <p className={styles.noCollectionData}>{strings.CollectionDataEmptyValue}</p>\n          )\n        }\n\n        <div className={styles.panelActions}>\n          { this.state.inCreationItem && <PrimaryButton text={strings.CollectionSaveAndAddButtonLabel} onClick={this.addAndSave} disabled={!this.allItemsValid()} /> }\n          { !this.state.inCreationItem && <PrimaryButton text={strings.SaveButtonLabel} onClick={this.onSave} disabled={!this.allItemsValid()} /> }\n          <DefaultButton text={strings.CancelButtonLabel} onClick={this.onCancel} />\n        </div>\n      </div>\n    );\n  }\n}\n"],"sourceRoot":"../../../../src"}