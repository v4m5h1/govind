{"version":3,"sources":["services/PeopleSearchService.ts"],"names":[],"mappings":"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","file":"services/PeopleSearchService.js","sourcesContent":["import { ISPHttpClientOptions, SPHttpClient, SPHttpClientResponse } from '@microsoft/sp-http';\nimport { Environment, EnvironmentType } from '@microsoft/sp-core-library';\nimport { WebPartContext } from '@microsoft/sp-webpart-base';\nimport { ExtensionContext } from '@microsoft/sp-extension-base';\nimport { MockUsers, PeoplePickerMockClient } from './PeoplePickerMockClient';\nimport { PrincipalType, IPeoplePickerUserItem } from \"../PeoplePicker\";\nimport { IUsers, IUserInfo } from \"../controls/peoplepicker/IUsers\";\nimport { cloneDeep, findIndex } from \"@microsoft/sp-lodash-subset\";\n\n/**\n * Service implementation to search people in SharePoint\n */\nexport default class SPPeopleSearchService {\n  private cachedPersonas: { [property: string]: IUserInfo[] };\n  private cachedLocalUsers: { [siteUrl: string]: IUserInfo[] };\n\n  /**\n   * Service constructor\n   */\n  constructor(private context: WebPartContext | ExtensionContext) {\n    this.cachedPersonas = {};\n    this.cachedLocalUsers = {};\n    this.cachedLocalUsers[this.context.pageContext.web.absoluteUrl] = [];\n  }\n\n  /**\n   * Generate the user photo link using SharePoint user photo endpoint.\n   *\n   * @param value\n   */\n  public generateUserPhotoLink(value: string): string {\n    return `${this.context.pageContext.web.absoluteUrl}/_layouts/15/userphoto.aspx?accountname=${encodeURIComponent(value)}&size=M`;\n  }\n\n  /**\n   * Generate sum of principal types\n   * \n   * PrincipalType controls the type of entities that are returned in the results.\n   * Choices are All - 15, Distribution List - 2 , Security Groups - 4, SharePoint Groups - 8, User - 1.\n   * These values can be combined (example: 13 is security + SP groups + users)\n   * \n   * @param principalTypes \n   */\n  public getSumOfPrincipalTypes(principalTypes: PrincipalType[]) {\n    return !!principalTypes && principalTypes.length > 0 ? principalTypes.reduce((a, b) => a + b, 0) : 1;\n  }\n\n  /**\n   * Retrieve the specified group\n   *\n   * @param groupName\n   * @param siteUrl\n   */\n  public async getGroupId(groupName: string, siteUrl: string = null): Promise<number | null> {\n    if (Environment.type === EnvironmentType.Local) {\n      return 1;\n    } else {\n      const groups = await this.searchTenant(siteUrl, groupName, 1, [PrincipalType.SharePointGroup], false, 0);\n      return (groups && groups.length > 0) ? parseInt(groups[0].id) : null;\n    }\n  }\n\n  /**\n   * Search person by its email or login name\n   */\n  public async searchPersonByEmailOrLogin(email: string, principalTypes: PrincipalType[], siteUrl: string = null, groupId: number = null, ensureUser: boolean = false): Promise<IPeoplePickerUserItem> {\n    if (Environment.type === EnvironmentType.Local) {\n      // If the running environment is local, load the data from the mock\n      const mockUsers = await this.searchPeopleFromMock(email);\n      return (mockUsers && mockUsers.length > 0) ? mockUsers[0] : null;\n    } else {\n      const userResults = await this.searchTenant(siteUrl, email, 1, principalTypes, ensureUser, groupId);\n      return (userResults && userResults.length > 0) ? userResults[0] : null;\n    }\n  }\n\n  /**\n   * Search All Users from the SharePoint People database\n   */\n  public async searchPeople(query: string, maximumSuggestions: number, principalTypes: PrincipalType[], siteUrl: string = null, groupId: number = null, ensureUser: boolean = false): Promise<IPeoplePickerUserItem[]> {\n    if (Environment.type === EnvironmentType.Local) {\n      // If the running environment is local, load the data from the mock\n      return this.searchPeopleFromMock(query);\n    } else {\n      return await this.searchTenant(siteUrl, query, maximumSuggestions, principalTypes, ensureUser, groupId);\n    }\n  }\n\n  /**\n   * Local site search\n   */\n  private async localSearch(siteUrl: string, query: string, principalTypes: PrincipalType[], showHiddenInUI: boolean, groupName: string, exactMatch: boolean = false): Promise<IPeoplePickerUserItem[]> {\n    try {\n      let stringVal: string = \"\";\n      let cachedPropertyName: string = null;\n\n      // Check if service needs to search in the site or group\n      if (groupName) {\n        stringVal = `/_api/web/sitegroups/GetByName('${groupName}')/users`;\n        cachedPropertyName = `${siteUrl}-${groupName}`;\n      } else {\n        stringVal = \"/_api/web/siteusers\";\n        cachedPropertyName = siteUrl;\n      }\n\n      if (typeof this.cachedPersonas[cachedPropertyName] === \"undefined\") {\n        // filter for principal Type\n        let filterVal: string = \"\";\n        if (principalTypes) {\n          filterVal = `?$filter=(${principalTypes.map(principalType => `PrincipalType eq ${principalType}`).join(\" or \")})`;\n        }\n\n        // filter for showHiddenInUI\n        filterVal = filterVal ? `${filterVal} and (IsHiddenInUI eq ${showHiddenInUI})` : `?$filter=IsHiddenInUI eq ${showHiddenInUI}`;\n\n        // Create the rest API\n        const restApi = `${siteUrl}${stringVal}${filterVal}`;\n        const data = await this.context.spHttpClient.get(restApi, SPHttpClient.configurations.v1, {\n          headers: {\n            'Accept': 'application/json;odata.metadata=none'\n          }\n        });\n\n        if (data.ok) {\n          const userDataResp: IUsers = await data.json();\n          if (userDataResp && userDataResp.value && userDataResp.value.length > 0) {\n            this.cachedPersonas[cachedPropertyName] = cloneDeep(userDataResp.value);\n          }\n        }\n      }\n\n      // Check if persons or groups were retrieved and return the ones for the query\n      if (this.cachedPersonas[cachedPropertyName]) {\n        let persons = this.cachedPersonas[cachedPropertyName];\n        if (query) {\n          // Check if exact match is required\n          if (exactMatch) {\n            persons = persons.filter(element => element.Email.toLowerCase() === query.toLowerCase() || element.LoginName.toLowerCase() === query.toLowerCase());\n          } else {\n            persons = persons.filter(element => element.Title.toLowerCase().indexOf(query.toLowerCase()) !== -1 || element.Email.toLowerCase().indexOf(query.toLowerCase()) !== -1 || element.LoginName.toLowerCase().indexOf(query.toLowerCase()) !== -1);\n          }\n        }\n\n        return persons.map(item => ({\n          id: item.Id.toString(),\n          imageUrl: item.PrincipalType === PrincipalType.User ? this.generateUserPhotoLink(item.Email) : null,\n          imageInitials: this.getFullNameInitials(item.Title),\n          text: item.Title, // name\n          secondaryText: item.Email || item.LoginName, // email\n          tertiaryText: \"\", // status\n          optionalText: \"\" // anything\n        } as IPeoplePickerUserItem));\n      }\n\n      // Nothing to return\n      return [];\n    } catch (e) {\n      console.error(\"PeopleSearchService::localSearch: error occured while fetching the users.\");\n      return [];\n    }\n  }\n\n  /**\n   * Tenant search\n   */\n  private async searchTenant(siteUrl: string, query: string, maximumSuggestions: number, principalTypes: PrincipalType[], ensureUser: boolean, groupId: number): Promise<IPeoplePickerUserItem[]> {\n    try {\n      // If the running env is SharePoint, loads from the peoplepicker web service\n      const userRequestUrl: string = `${siteUrl || this.context.pageContext.web.absoluteUrl}/_api/SP.UI.ApplicationPages.ClientPeoplePickerWebServiceInterface.clientPeoplePickerSearchUser`;\n      const searchBody = {\n        queryParams: {\n          AllowEmailAddresses: true,\n          AllowMultipleEntities: false,\n          AllUrlZones: false,\n          MaximumEntitySuggestions: maximumSuggestions,\n          PrincipalSource: 15,\n          PrincipalType: this.getSumOfPrincipalTypes(principalTypes),\n          QueryString: query\n        }\n      };\n\n      // Search on the local site when \"0\"\n      if (siteUrl) {\n        searchBody.queryParams[\"SharePointGroupID\"] = 0;\n      }\n\n      // Check if users need to be searched in a specific group\n      if (groupId) {\n        searchBody.queryParams[\"SharePointGroupID\"] = groupId;\n      }\n\n      const httpPostOptions: ISPHttpClientOptions = {\n        headers: {\n          'accept': 'application/json',\n          'content-type': 'application/json'\n        },\n        body: JSON.stringify(searchBody)\n      };\n\n      // Do the call against the People REST API endpoint\n      const data = await this.context.spHttpClient.post(userRequestUrl, SPHttpClient.configurations.v1, httpPostOptions);\n      if (data.ok) {\n        const userDataResp = await data.json();\n        if (userDataResp && userDataResp.value && userDataResp.value.length > 0) {\n          let values: any = userDataResp.value;\n\n          if (typeof userDataResp.value === \"string\") {\n            values = JSON.parse(userDataResp.value);\n          }\n\n          // Filter out \"UNVALIDATED_EMAIL_ADDRESS\"\n          values = values.filter(v => !(v.EntityData && v.EntityData.PrincipalType && v.EntityData.PrincipalType === \"UNVALIDATED_EMAIL_ADDRESS\"));\n\n          // Check if local user IDs need to be retrieved\n          if (ensureUser) {\n            for (const value of values) {\n              // Only ensure the user if it is not a SharePoint group\n              if (!value.EntityData || (value.EntityData && typeof value.EntityData.SPGroupID === \"undefined\")) {\n                const id = await this.ensureUser(value.Key);\n                value.Key = id;\n              }\n            }\n          }\n\n          // Filter out NULL keys\n          values = values.filter(v => v.Key !== null);\n\n          const userResults = values.map(element => {\n            switch (element.EntityType) {\n              case 'User':\n                let email: string = element.EntityData.Email !== null ? element.EntityData.Email : element.Description;\n                return {\n                  id: element.Key,\n                  imageUrl: this.generateUserPhotoLink(email),\n                  imageInitials: this.getFullNameInitials(element.DisplayText),\n                  text: element.DisplayText, // name\n                  secondaryText: email, // email\n                  tertiaryText: \"\", // status\n                  optionalText: \"\" // anything\n                } as IPeoplePickerUserItem;\n              case 'SecGroup':\n                return {\n                  id: element.Key,\n                  imageInitials: this.getFullNameInitials(element.DisplayText),\n                  text: element.DisplayText,\n                  secondaryText: element.ProviderName\n                } as IPeoplePickerUserItem;\n              case 'FormsRole':\n                return {\n                  id: element.Key,\n                  imageInitials: this.getFullNameInitials(element.DisplayText),\n                  text: element.DisplayText,\n                  secondaryText: element.ProviderName\n                } as IPeoplePickerUserItem;\n              default:\n                return {\n                  id: element.EntityData.SPGroupID,\n                  imageInitials: this.getFullNameInitials(element.DisplayText),\n                  text: element.DisplayText,\n                  secondaryText: element.EntityData.AccountName\n                } as IPeoplePickerUserItem;\n            }\n          });\n\n          return userResults;\n        }\n      }\n\n      // Nothing to return\n      return [];\n    } catch (e) {\n      console.error(\"PeopleSearchService::searchTenant: error occured while fetching the users.\");\n      return [];\n    }\n  }\n\n  /**\n   * Retrieves the local user ID\n   *\n   * @param userId\n   */\n  private async ensureUser(userId: string): Promise<number> {\n    const siteUrl = this.context.pageContext.web.absoluteUrl;\n    if (this.cachedLocalUsers && this.cachedLocalUsers[siteUrl]) {\n      const users = this.cachedLocalUsers[siteUrl];\n      const userIdx = findIndex(users, u => u.LoginName === userId);\n      if (userIdx !== -1) {\n        return users[userIdx].Id;\n      }\n    }\n\n    const restApi = `${siteUrl}/_api/web/ensureuser`;\n    const data = await this.context.spHttpClient.post(restApi, SPHttpClient.configurations.v1, {\n      body: JSON.stringify({ 'logonName': userId })\n    });\n\n    if (data.ok) {\n      const user: IUserInfo = await data.json();\n      if (user && user.Id) {\n        this.cachedLocalUsers[siteUrl].push(user);\n        return user.Id;\n      }\n    }\n\n    return null;\n  }\n\n  /**\n   * Generates Initials from a full name\n   */\n  private getFullNameInitials(fullName: string): string {\n    if (fullName === null) {\n      return fullName;\n    }\n\n    const words: string[] = fullName.split(' ');\n    if (words.length === 0) {\n      return '';\n    } else if (words.length === 1) {\n      return words[0].charAt(0);\n    } else {\n      return (words[0].charAt(0) + words[1].charAt(0));\n    }\n  }\n\n  /**\n   * Gets the user photo url\n   */\n  private getUserPhotoUrl(userEmail: string, siteUrl: string): string {\n    return `${siteUrl}/_layouts/15/userphoto.aspx?size=S&accountname=${userEmail}`;\n  }\n\n\n  /**\n   * Returns fake people results for the Mock mode\n   */\n  private searchPeopleFromMock(query: string): Promise<Array<IPeoplePickerUserItem>> {\n    let mockClient: PeoplePickerMockClient = new PeoplePickerMockClient();\n    let filterValue = { valToCompare: query };\n    return new Promise<Array<IPeoplePickerUserItem>>((resolve) => resolve(MockUsers.filter(mockClient.filterPeople, filterValue)));\n  }\n}\n"],"sourceRoot":"../../src"}