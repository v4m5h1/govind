{"version":3,"file":"Customizer.js","sourceRoot":"../src/","sources":["Customizer.tsx"],"names":[],"mappings":";;;AAAA,6BAA+B;AAC/B,sCAAwC;AACxC,iDAA4D;AAmD5D;;;;;;;;;;;;GAYG;AACH;IAAgC,sCAAmD;IAWjF,kCAAkC;IAClC,oBAAY,KAAuB,EAAE,OAAY;QAAjD,YACE,kBAAM,KAAK,CAAC,SAGb;QADC,KAAI,CAAC,KAAK,GAAG,KAAI,CAAC,kBAAkB,CAAC,KAAK,EAAE,OAAO,CAAC,CAAC;;IACvD,CAAC;IAEM,oCAAe,GAAtB;QACE,OAAO,IAAI,CAAC,KAAK,CAAC;IACpB,CAAC;IAED,kCAAkC;IAC3B,8CAAyB,GAAhC,UAAiC,QAAa,EAAE,UAAe;QAC7D,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,kBAAkB,CAAC,QAAQ,EAAE,UAAU,CAAC,CAAC,CAAC;IAC/D,CAAC;IAEM,2BAAM,GAAb;QACE,OAAO,KAAK,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC;IAClD,CAAC;IAEO,uCAAkB,GAA1B,UACE,KAAuB,EACvB,OAA2B;QAGzB,IAAA,2BAAqD,EAArD,0EAAqD,CAC3C;QAEZ,OAAO;YACL,cAAc,EAAE;gBACd,QAAQ,EAAE,aAAa,CAAC,cAAc,CAAC,QAAQ,EAAE,KAAK,CAAC,QAAQ,CAAC;gBAChE,cAAc,EAAE,mBAAmB,CAAC,cAAc,CAAC,cAAc,EAAE,KAAK,CAAC,cAAc,CAAC;aACzF;SACF,CAAC;IACJ,CAAC;IA5Ca,uBAAY,GAEtB;QACA,cAAc,EAAE,SAAS,CAAC,MAAM;KACjC,CAAC;IAEU,4BAAiB,GAE3B,UAAU,CAAC,YAAY,CAAC;IAqC9B,iBAAC;CAAA,AA9CD,CAAgC,6BAAa,GA8C5C;AA9CY,gCAAU;AAgDvB,uBAAuB,WAA0B,EAAE,WAAyC;IAArE,4BAAA,EAAA,gBAA0B;IAC/C,IAAM,iBAAiB,GAAG,kBAAkB,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,WAAW,CAAC,CAAC,CAAC,iBAAiB,CAAC,WAAW,CAAC,CAAC;IAEzG,OAAO,iBAAiB,CAAC,WAAW,CAAC,CAAC;AACxC,CAAC;AAED,6BAA6B,WAA0B,EAAE,WAAyC;IAArE,4BAAA,EAAA,gBAA0B;IACrD,IAAM,iBAAiB,GAAG,kBAAkB,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,WAAW,CAAC,CAAC,CAAC,uBAAuB,CAAC,WAAW,CAAC,CAAC;IAE/G,OAAO,iBAAiB,CAAC,WAAW,CAAC,CAAC;AACxC,CAAC;AAED,4BAA4B,QAAsC;IAChE,OAAO,OAAO,QAAQ,KAAK,UAAU,CAAC;AACxC,CAAC;AAED,2BAA2B,WAAoB;IAC7C,OAAO,UAAC,QAAkB,IAAK,OAAA,WAAW,CAAC,CAAC,sBAAM,WAAW,EAAK,QAAQ,EAAG,CAAC,CAAC,QAAQ,EAAxD,CAAwD,CAAC;AAC1F,CAAC;AAED,iCAAiC,uBAAsC;IAAtC,wCAAA,EAAA,4BAAsC;IACrE,OAAO,UAAC,iBAA2B;QACjC,IAAM,iBAAiB,wBAAkB,iBAAiB,CAAE,CAAC;QAE7D,KAAK,IAAI,SAAS,IAAI,uBAAuB,EAAE;YAC7C,IAAI,uBAAuB,CAAC,cAAc,CAAC,SAAS,CAAC,EAAE;gBACrD,iBAAiB,CAAC,SAAS,CAAC,wBAAQ,iBAAiB,CAAC,SAAS,CAAC,EAAK,uBAAuB,CAAC,SAAS,CAAC,CAAE,CAAC;aAC3G;SACF;QAED,OAAO,iBAAiB,CAAC;IAC3B,CAAC,CAAC;AACJ,CAAC","sourcesContent":["import * as React from 'react';\r\nimport * as PropTypes from 'prop-types';\r\nimport { BaseComponent, IBaseProps } from './BaseComponent';\r\nimport { ICustomizations, Settings, SettingsFunction } from './Customizations';\r\n\r\nexport interface ICustomizerContext {\r\n  customizations: ICustomizations;\r\n}\r\n\r\nexport type ICustomizerProps = IBaseProps & Partial<{\r\n  /**\r\n   * @description\r\n   * Settings are used as general settings for the React tree below.\r\n   * Components can subscribe to receive the settings by using `customizable`.\r\n   *\r\n   * @example\r\n   * Settings can be represented by a plain object that contains the key value pairs.\r\n   * ```\r\n   *  <Customizer settings={{ color: 'red' }} />\r\n   * ```\r\n   * or a function that receives the current settings and returns the new ones\r\n   * ```\r\n   *  <Customizer settings={(currentSettings) => ({ ...currentSettings, color: 'red' })} />\r\n   * ```\r\n   */\r\n  settings: Settings | SettingsFunction;\r\n  /**\r\n   * @description\r\n   * Scoped settings are settings that are scoped to a specific scope. The\r\n   * scope is the name that is passed to the `customizable` function when the\r\n   * the component is customized.\r\n   *\r\n   * @example\r\n   * Scoped settings can be represented by a plain object that contains the key value pairs.\r\n   * ```\r\n   *  const myScopedSettings = {\r\n   *    Button: { color: 'red' };\r\n   *  };\r\n   *\r\n   *  <Customizer scopedSettings={myScopedSettings} />\r\n   * ```\r\n   * or a function that receives the current settings and returns the new ones\r\n   * ```\r\n   *  const myScopedSettings = {\r\n   *    Button: { color: 'red' };\r\n   *  };\r\n   *\r\n   *  <Customizer scopedSettings={(currentScopedSettings) => ({ ...currentScopedSettings, ...myScopedSettings })} />\r\n   * ```\r\n   */\r\n  scopedSettings: Settings | SettingsFunction\r\n}>;\r\n\r\n/**\r\n * The Customizer component allows for default props to be mixed into components which\r\n * are decorated with the customizable() decorator. This enables injection scenarios like:\r\n *\r\n * 1. render svg icons instead of the icon font within all buttons\r\n * 2. inject a custom theme object into a component\r\n *\r\n * Props are provided via the settings prop which should be one of the following:\r\n * - A json map which contains 1 or more name/value pairs representing injectable props.\r\n * - A function that receives the current settings and returns the new ones that apply to the scope\r\n *\r\n * @public\r\n */\r\nexport class Customizer extends BaseComponent<ICustomizerProps, ICustomizerContext> {\r\n  public static contextTypes: {\r\n    customizations: PropTypes.Requireable<{}>;\r\n  } = {\r\n      customizations: PropTypes.object\r\n    };\r\n\r\n  public static childContextTypes: {\r\n    customizations: PropTypes.Requireable<{}>;\r\n  } = Customizer.contextTypes;\r\n\r\n  // tslint:disable-next-line:no-any\r\n  constructor(props: ICustomizerProps, context: any) {\r\n    super(props);\r\n\r\n    this.state = this._getCustomizations(props, context);\r\n  }\r\n\r\n  public getChildContext(): ICustomizerContext {\r\n    return this.state;\r\n  }\r\n\r\n  // tslint:disable-next-line:no-any\r\n  public componentWillReceiveProps(newProps: any, newContext: any): void {\r\n    this.setState(this._getCustomizations(newProps, newContext));\r\n  }\r\n\r\n  public render(): React.ReactElement<{}> {\r\n    return React.Children.only(this.props.children);\r\n  }\r\n\r\n  private _getCustomizations(\r\n    props: ICustomizerProps,\r\n    context: ICustomizerContext\r\n  ): ICustomizerContext {\r\n    const {\r\n      customizations = { settings: {}, scopedSettings: {} }\r\n    } = context;\r\n\r\n    return {\r\n      customizations: {\r\n        settings: mergeSettings(customizations.settings, props.settings),\r\n        scopedSettings: mergeScopedSettings(customizations.scopedSettings, props.scopedSettings),\r\n      }\r\n    };\r\n  }\r\n}\r\n\r\nfunction mergeSettings(oldSettings: Settings = {}, newSettings?: Settings | SettingsFunction): Settings {\r\n  const mergeSettingsWith = isSettingsFunction(newSettings) ? newSettings : settingsMergeWith(newSettings);\r\n\r\n  return mergeSettingsWith(oldSettings);\r\n}\r\n\r\nfunction mergeScopedSettings(oldSettings: Settings = {}, newSettings?: Settings | SettingsFunction): Settings {\r\n  const mergeSettingsWith = isSettingsFunction(newSettings) ? newSettings : scopedSettingsMergeWith(newSettings);\r\n\r\n  return mergeSettingsWith(oldSettings);\r\n}\r\n\r\nfunction isSettingsFunction(settings?: Settings | SettingsFunction): settings is SettingsFunction {\r\n  return typeof settings === 'function';\r\n}\r\n\r\nfunction settingsMergeWith(newSettings?: object): (settings: Settings) => Settings {\r\n  return (settings: Settings) => newSettings ? { ...newSettings, ...settings } : settings;\r\n}\r\n\r\nfunction scopedSettingsMergeWith(scopedSettingsFromProps: Settings = {}): (scopedSettings: Settings) => Settings {\r\n  return (oldScopedSettings: Settings): Settings => {\r\n    const newScopedSettings: Settings = { ...oldScopedSettings };\r\n\r\n    for (let scopeName in scopedSettingsFromProps) {\r\n      if (scopedSettingsFromProps.hasOwnProperty(scopeName)) {\r\n        newScopedSettings[scopeName] = { ...oldScopedSettings[scopeName], ...scopedSettingsFromProps[scopeName] };\r\n      }\r\n    }\r\n\r\n    return newScopedSettings;\r\n  };\r\n}"]}